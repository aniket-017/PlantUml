@startuml
actor Customer
actor Pharmacist
actor System

Customer -> CSX: Enter IDs and click Continue
CSX -> Kafka: Send identification data
Kafka -> GE: Forward patient data
GE -> EPS: Fetch patient and prescription data
EPS -> GE: Return prescription and patient data
GE -> Kafka: Push data
Kafka -> TMX: Deliver prescription data
TMX -> Pharmacist: Display full prescription list
TMX -> CSX: Share copay amount

Pharmacist -> TMX: Perform scan-scan validation
TMX -> Kafka: Send scanned prescription data
Kafka -> GE: Forward data
GE -> EPS: Validate safety
EPS -> GE: Return validation result
GE -> Kafka: Push validation result
Kafka -> TMX: Deliver validation status
TMX -> Pharmacist: Receive validation status

Pharmacist -> TMX: Initiate compliance request
TMX -> Kafka: Send request
Kafka -> GE: Forward request
GE -> EPS: Store compliance request
EPS -> GE: Acknowledge compliance
GE -> Kafka: Deliver compliance acknowledgment
TMX -> CSX: Display compliance document
CSX -> Customer: Review and sign
CSX -> TMX: Send signed document
TMX -> Kafka: Save signature record
Kafka -> GE: Notify saved record
GE -> EPS: Confirm update
TMX -> Pharmacist: Show completion status

Pharmacist -> TMX: Initiate payment transaction
TMX -> Kafka: Payment request initiated
Kafka -> ACS: Forward payment request
ACS -> PG: Process payment
PG -> ACS: Return payment success
ACS -> Kafka: Notify payment success
Kafka -> GE: Update payment details
GE -> EPS: Submit update confirmation
EPS -> GE: Acknowledge update
GE -> Kafka: Deliver payment status
TMX -> Customer: Confirm transaction

Customer -> CSX: Enter invalid data
CSX -> Customer: Display error message

Pharmacist -> TMX: Validate with invalid data
TMX -> Kafka: Send scanned data
Kafka -> GE: Forward data
GE -> EPS: Validate and fail
GE -> Kafka: Push failure result
Kafka -> TMX: Inform failure

Customer -> CSX: Open compliance document
CSX -> Customer: Display error if unsigned
CSX -> TMX: Save unsigned document

System -> EPS: Remove test records
System -> Kafka: Close connections
System -> System: Clean up test data
@enduml